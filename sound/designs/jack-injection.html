<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALSA Jack Software Injection &mdash; The Linux Kernel  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_rtd_colors.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ALSA SoC Layer" href="../soc/index.html" />
    <link rel="prev" title="OSS Sequencer Emulation on ALSA" href="seq-oss.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          </a>
              <div class="version">
                6.1.0-rc6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Linux Sound Subsystem Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../kernel-api/index.html">ALSA Kernel API Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Designs and Implementations</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="control-names.html">Standard ALSA Control Names</a></li>
<li class="toctree-l4"><a class="reference internal" href="channel-mapping-api.html">ALSA PCM channel-mapping API</a></li>
<li class="toctree-l4"><a class="reference internal" href="compress-offload.html">ALSA Compress-Offload API</a></li>
<li class="toctree-l4"><a class="reference internal" href="timestamping.html">ALSA PCM Timestamping</a></li>
<li class="toctree-l4"><a class="reference internal" href="jack-controls.html">ALSA Jack Controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="tracepoints.html">Tracepoints in ALSA</a></li>
<li class="toctree-l4"><a class="reference internal" href="procfile.html">Proc Files of ALSA Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="powersave.html">Notes on Power-Saving Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="oss-emulation.html">Notes on Kernel OSS-Emulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="seq-oss.html">OSS Sequencer Emulation on ALSA</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">ALSA Jack Software Injection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../soc/index.html">ALSA SoC Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alsa-configuration.html">Advanced Linux Sound Architecture - Driver Configuration guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hd-audio/index.html">HD-Audio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cards/index.html">Card-Specific Information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../subsystem-apis.html">Kernel subsystem documentation</a> &raquo;</li>
          <li><a href="../index.html">Linux Sound Subsystem Documentation</a> &raquo;</li>
          <li><a href="index.html">Designs and Implementations</a> &raquo;</li>
      <li>ALSA Jack Software Injection</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/sound/designs/jack-injection.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="alsa-jack-software-injection">
<h1>ALSA Jack Software Injection<a class="headerlink" href="#alsa-jack-software-injection" title="Permalink to this heading">¶</a></h1>
<section id="simple-introduction-on-jack-injection">
<h2>Simple Introduction On Jack Injection<a class="headerlink" href="#simple-introduction-on-jack-injection" title="Permalink to this heading">¶</a></h2>
<p>Here jack injection means users could inject plugin or plugout events
to the audio jacks through debugfs interface, it is helpful to
validate ALSA userspace changes. For example, we change the audio
profile switching code in the pulseaudio, and we want to verify if the
change works as expected and if the change introduce the regression,
in this case, we could inject plugin or plugout events to an audio
jack or to some audio jacks, we don’t need to physically access the
machine and plug/unplug physical devices to the audio jack.</p>
<p>In this design, an audio jack doesn’t equal to a physical audio jack.
Sometimes a physical audio jack contains multi functions, and the
ALSA driver creates multi <code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code> for a <code class="docutils literal notranslate"><span class="pre">snd_jack</span></code>, here the
<code class="docutils literal notranslate"><span class="pre">snd_jack</span></code> represents a physical audio jack and the <code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code>
represents a function, for example a physical jack has two functions:
headphone and mic_in, the ALSA ASoC driver will build 2 <code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code>
for this jack. The jack injection is implemented based on the
<code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code> instead of <code class="docutils literal notranslate"><span class="pre">snd_jack</span></code>.</p>
<p>To inject events to audio jacks, we need to enable the jack injection
via <code class="docutils literal notranslate"><span class="pre">sw_inject_enable</span></code> first, once it is enabled, this jack will not
change the state by hardware events anymore, we could inject plugin or
plugout events via <code class="docutils literal notranslate"><span class="pre">jackin_inject</span></code> and check the jack state via
<code class="docutils literal notranslate"><span class="pre">status</span></code>, after we finish our test, we need to disable the jack
injection via <code class="docutils literal notranslate"><span class="pre">sw_inject_enable</span></code> too, once it is disabled, the jack
state will be restored according to the last reported hardware events
and will change by future hardware events.</p>
</section>
<section id="the-layout-of-jack-injection-interface">
<h2>The Layout of Jack Injection Interface<a class="headerlink" href="#the-layout-of-jack-injection-interface" title="Permalink to this heading">¶</a></h2>
<p>If users enable the SND_JACK_INJECTION_DEBUG in the kernel, the audio
jack injection interface will be created as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$debugfs_mount_dir/sound
|-- card0
|-- |-- HDMI_DP_pcm_10_Jack
|-- |-- |-- jackin_inject
|-- |-- |-- kctl_id
|-- |-- |-- mask_bits
|-- |-- |-- status
|-- |-- |-- sw_inject_enable
|-- |-- |-- type
...
|-- |-- HDMI_DP_pcm_9_Jack
|--     |-- jackin_inject
|--     |-- kctl_id
|--     |-- mask_bits
|--     |-- status
|--     |-- sw_inject_enable
|--     |-- type
|-- card1
    |-- HDMI_DP_pcm_5_Jack
    |-- |-- jackin_inject
    |-- |-- kctl_id
    |-- |-- mask_bits
    |-- |-- status
    |-- |-- sw_inject_enable
    |-- |-- type
    ...
    |-- Headphone_Jack
    |-- |-- jackin_inject
    |-- |-- kctl_id
    |-- |-- mask_bits
    |-- |-- status
    |-- |-- sw_inject_enable
    |-- |-- type
    |-- Headset_Mic_Jack
        |-- jackin_inject
        |-- kctl_id
        |-- mask_bits
        |-- status
        |-- sw_inject_enable
        |-- type
</pre></div>
</div>
</section>
<section id="the-explanation-of-the-nodes">
<h2>The Explanation Of The Nodes<a class="headerlink" href="#the-explanation-of-the-nodes" title="Permalink to this heading">¶</a></h2>
<dl>
<dt>kctl_id</dt><dd><p>read-only, get jack_kctl-&gt;kctl’s id</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat kctl_id
Headphone Jack
</pre></div>
</div>
</dd>
<dt>mask_bits</dt><dd><p>read-only, get jack_kctl’s supported events mask_bits</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat mask_bits
0x0001 HEADPHONE(0x0001)
</pre></div>
</div>
</dd>
<dt>status</dt><dd><p>read-only, get jack_kctl’s current status</p>
</dd>
</dl>
<ul>
<li><p>headphone unplugged:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat status
Unplugged
</pre></div>
</div>
</li>
<li><p>headphone plugged:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat status
Plugged
</pre></div>
</div>
</li>
</ul>
<dl>
<dt>type</dt><dd><p>read-only, get snd_jack’s supported events from type (all supported events on the physical audio jack)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat type
0x7803 HEADPHONE(0x0001) MICROPHONE(0x0002) BTN_3(0x0800) BTN_2(0x1000) BTN_1(0x2000) BTN_0(0x4000)
</pre></div>
</div>
</dd>
<dt>sw_inject_enable</dt><dd><p>read-write, enable or disable injection</p>
</dd>
</dl>
<ul>
<li><p>injection disabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat sw_inject_enable
Jack: Headphone Jack               Inject Enabled: 0
</pre></div>
</div>
</li>
<li><p>injection enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat sw_inject_enable
Jack: Headphone Jack               Inject Enabled: 1
</pre></div>
</div>
</li>
<li><p>to enable jack injection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 1 &gt; sw_inject_enable
</pre></div>
</div>
</li>
<li><p>to disable jack injection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 0 &gt; sw_inject_enable
</pre></div>
</div>
</li>
</ul>
<dl class="simple">
<dt>jackin_inject</dt><dd><p>write-only, inject plugin or plugout</p>
</dd>
</dl>
<ul>
<li><p>to inject plugin:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 1 &gt; jackin_inject
</pre></div>
</div>
</li>
<li><p>to inject plugout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 0 &gt; jackin_inject
</pre></div>
</div>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="seq-oss.html" class="btn btn-neutral float-left" title="OSS Sequencer Emulation on ALSA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../soc/index.html" class="btn btn-neutral float-right" title="ALSA SoC Layer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright The kernel development community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>